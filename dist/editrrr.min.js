/*!
 * editrrr - version 0.1.0
 *
 * Made with ❤ by Steve Ottoz so@dev.so
 *
 * Copyright (c) 2017 Steve Ottoz
 */
(function(f,g){if('function'==typeof define&&define.amd)define(['module','exports'],g);else if('undefined'!=typeof exports)g(module,exports);else{var h={exports:{}};g(h,h.exports),f.Editrrr=h.exports}})(this,function(f,g){'use strict';function h(o,p){if(!(o instanceof p))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(g,'__esModule',{value:!0});var j=function(){function o(p,q){for(var r=0;r<q.length;r++){var s=q[r];s.enumerable=s.enumerable,s.configurable=!0,'value'in s&&(s.writable=!0),Object.defineProperty(p,s.key,s)}}return function(p,q,r){return q&&o(p.prototype,q),r&&o(p,r),p}}(),k={textarea:null,replaceTab:!0,softTabs:!0,tabSize:2,autoOpen:!0,overwrite:!0,autoStrip:!0,autoIndent:!0,continueList:!0,moveLine:!0,duplicateLine:!0},l=[{open:'"',close:'"',canBreak:!1},{open:'\'',close:'\'',canBreak:!1},{open:'`',close:'`',canBreak:!1},{open:'(',close:')',canBreak:!1},{open:'[',close:']',canBreak:!0},{open:'{',close:'}',canBreak:!0},{open:'<',close:'>',canBreak:!1}],m={},n=function(){function o(p){h(this,o),this.options=Object.assign({},k,p),this.textarea=this.options.textarea,this.init()}return j(o,[{key:'callHook',value:function(q,r){var s=o.getHook(q);if(s){this.textarea.value,this.getCursor();var t=!0,u=!1,v=void 0;try{for(var x,w=s[Symbol.iterator]();!(t=(x=w.next()).done);t=!0){var y=x.value;y.call(this,this,r)}}catch(z){u=!0,v=z}finally{try{!t&&w.return&&w.return()}finally{if(u)throw v}}}return this}},{key:'getLineNr',value:function(){var q=0>=arguments.length||void 0===arguments[0]?this.getCursor():arguments[0];return this.value.substring(0,q).split('\n').length}},{key:'getLine',value:function(){var q=0>=arguments.length||void 0===arguments[0]?this.getCursor():arguments[0];return this.value.substring(0,q).split('\n').pop()}},{key:'getLines',value:function(){return this.value.split(/\r?\n/)}},{key:'getCursor',value:function(){return this.textarea.selectionStart}},{key:'setCursor',value:function(q){var r=1>=arguments.length||void 0===arguments[1]?q:arguments[1];return this.textarea.focus(),this.textarea.setSelectionRange(q,r),this}},{key:'getSelection',value:function(){var q=this.textarea.selectionStart,r=this.textarea.selectionEnd;return q!==r&&{start:q,end:r}}},{key:'focus',value:function(){return this.textarea.focus(),this}},{key:'blur',value:function(){return this.textarea.blur(),this}},{key:'levelsDeep',value:function(){var q=this.getCursor(),r=this.value.substring(0,q),s=['\'','"'],t=0,u=0,v=void 0,w=!0,x=!1,y=void 0;try{for(var A,z=r[Symbol.iterator]();!(w=(A=z.next()).done);w=!0){var B=A.value,C=!0,D=!1,E=void 0;try{for(var G,F=l[Symbol.iterator]();!(C=(G=F.next()).done);C=!0){var H=G.value;H.canBreak&&(H.open===B&&t++,H.close===B&&t--)}}catch(U){D=!0,E=U}finally{try{!C&&F.return&&F.return()}finally{if(D)throw E}}}}catch(U){x=!0,y=U}finally{try{!w&&z.return&&z.return()}finally{if(x)throw y}}var I=!0,J=!1,K=void 0;try{for(var M,L=l[Symbol.iterator]();!(I=(M=L.next()).done);I=!0){var N=M.value;if(N.canBreak){var O=!0,P=!1,Q=void 0;try{for(var S,R=s[Symbol.iterator]();!(O=(S=R.next()).done);O=!0){var T=S.value;u+=r.split(T).filter(function(U,V){return V%2}).join('').split(N.open).length-1}}catch(U){P=!0,Q=U}finally{try{!O&&R.return&&R.return()}finally{if(P)throw Q}}}}}catch(U){J=!0,K=U}finally{try{!I&&L.return&&L.return()}finally{if(J)throw K}}return v=t-u,Math.max(v,0)}},{key:'tabKey',value:function(q){var r=void 0;if(9===q.keyCode){q.preventDefault(),this.callHook('tab:before');var s=this.getSelection(),t=this.getCursor();if(r=!0,s){for(var u=s.start;u--;)if('\n'===this.value.charAt(u)){s.start=u+1;break}var v=this.value.substring(s.start,s.end),w=v.split('\n');if(q.shiftKey){for(var x in w){var y=w[x];y.substring(0,this.tab.length)===this.tab&&(w[x]=y.substring(this.tab.length))}v=w.join('\n'),this.value=''+this.value.substring(0,s.start)+v+this.value.substring(s.end),this.setCursor(s.start,s.start+v.length)}else{for(var z in w)w[z]=this.tab+w[z];v=w.join('\n'),this.value=''+this.value.substring(0,s.start)+v+this.value.substring(s.end),this.setCursor(s.start,s.start+v.length)}}else{var A=this.value.substring(0,t),B=this.value.substring(t),C=''+A+this.tab+B;q.shiftKey?this.value.substring(t-this.tab.length,t)===this.tab&&(this.value=''+this.value.substring(0,t-this.tab.length)+B,this.setCursor(t-this.tab.length)):(this.value=C,this.setCursor(t+this.tab.length),r=!1)}this.callHook('tab:after')}return r}},{key:'enterKey',value:function(q){if(13===q.keyCode){q.preventDefault(),this.callHook('enter:before');var r=this.getCursor(),s=this.value.substring(0,r),t=this.value.substring(r),u=s.charAt(s.length-1),v=t.charAt(0),w=this.levelsDeep(),x='',y='',z=void 0;if(!w)z=1;else{for(;w--;)x+=this.tab;z=x.length+1;var A=!0,B=!1,C=void 0;try{for(var E,D=l[Symbol.iterator]();!(A=(E=D.next()).done);A=!0){var F=E.value;F.open===u&&F.close===v&&(y=this.newLine)}}catch(G){B=!0,C=G}finally{try{!A&&D.return&&D.return()}finally{if(B)throw C}}}this.value=''+s+this.newLine+x+y+x.substring(0,x.length-this.tab.length)+t,this.setCursor(r+z),this.callHook('enter:after')}}},{key:'enterKeyList',value:function(q){if(13===q.keyCode){q.preventDefault(),this.callHook('enter:before');var r=this.getCursor(),s=this.value.substring(0,r),t=this.value.substring(r),u=Math.max(0,s.split(/\r?\n/).length-2),v=this.getLines(),w=v[u],x=void 0,y=void 0;(x=w.match(/^\s*([\-\–\—\+\*\•\·\»\>]|\d+\.)\s(\[[\sx]\]\s)?/))&&(w===x[0]?(r-=w.length,v[u]='',y=v.join('\n')):(y=''+s+x[0]+t,r+=x[0].length),this.value=y,this.setCursor(r)),this.callHook('enter:after')}}},{key:'deleteKey',value:function(q){if(8===q.keyCode&&!q.altKey){q.preventDefault(),this.callHook('delete:before');var r=this.getCursor(),s=this.value.substring(0,r),t=this.value.substring(r),u=s.charAt(s.length-1),v=t.charAt(0);if(!1===this.getSelection()){var w=!0,x=!1,y=void 0;try{for(var A,z=l[Symbol.iterator]();!(w=(A=z.next()).done);w=!0){var B=A.value;if(B.open===u&&B.close===v)return this.value=''+this.value.substring(0,r-1)+this.value.substring(r+1),void this.setCursor(r-1)}}catch(D){x=!0,y=D}finally{try{!w&&z.return&&z.return()}finally{if(x)throw y}}this.value=''+this.value.substring(0,r-1)+this.value.substring(r),this.setCursor(r-1)}else{var C=this.getSelection();this.value=''+this.value.substring(0,C.start)+this.value.substring(C.end),this.setCursor(r)}this.callHook('delete:after')}}},{key:'moveLine',value:function(q){if(q.ctrlKey&&(this.isMac&&q.metaKey||this.isWin&&q.shiftKey)&&0<=[38,40].indexOf(q.keyCode)){q.preventDefault();var r=this.getSelection(),s=this.getLines();if(r){var t=this.getLineNr(r.start)-1,u=this.getLineNr(r.end)-1,v=void 0,w=void 0;if(38===q.keyCode){if(0<t){for(var x=t;x<=u;x++)s=this.lineUp(s,x);t--,u--}}else if(40===q.keyCode&&u<s.length-1){for(var y=u;y>=t;y--)s=this.lineDown(s,y);t++,u++}v=s.slice(0,t).join('\n').length,w=s.slice(0,u+1).join('\n').length,0<v&&v++,this.value=s.join('\n'),this.setCursor(v,w)}else{var z=this.getLineNr()-1,A=this.getCursor(),B=A;38===q.keyCode?0<z&&(s=this.lineUp(s,z),B=A-s[z].length-1):40===q.keyCode&&z<s.length-1&&(s=this.lineDown(s,z),B=A+s[z].length+1),this.value=s.join('\n'),this.setCursor(B)}}}},{key:'duplicateLine',value:function(q){if(q.shiftKey&&(this.isMac&&q.metaKey||this.isWin&&q.ctrlKey)&&68===q.keyCode){q.preventDefault();var r=this.getSelection(),s=this.getLines();if(r){var t=this.getLineNr(r.start)-1,u=this.getLineNr(r.end)-1,v=u-t+1,w=u,x=void 0,y=void 0;for(var z=t;z<=u;z++)w++,s.splice(w,0,s[z]);x=s.slice(0,t+v).join('\n').length,y=s.slice(0,u+v+1).join('\n').length,0<x&&x++,this.value=s.join('\n'),this.setCursor(x,y)}else{var A=this.getLineNr()-1,B=this.getCursor(),C=B;s.splice(A+1,0,s[A]),C=B+s[A].length+1,this.value=s.join('\n'),this.setCursor(C)}}}},{key:'openedChar',value:function(q,r){r.preventDefault(),this.callHook('openChar:before');var s=this.getCursor(),t=this.value.substring(0,s),u=this.value.substring(s);this.value=''+t+q.open+q.close+u,this.setCursor(s+1),this.callHook('openChar:after')}},{key:'closedChar',value:function(q,r){var s=this.getCursor(),t=this.value.substring(s,s+1);return t===q.close&&(r.preventDefault(),this.callHook('closeChar:before'),this.setCursor(s+1),this.callHook('closeChar:after'),!0)}},{key:'filter',value:function(q){var r=!0,s=!1,t=void 0;try{for(var v,u=l[Symbol.iterator]();!(r=(v=u.next()).done);r=!0){var w=v.value;if(w.close==q.key){var x=this.options.overwrite&&this.closedChar(w,q);!x&&w.open===q.key&&this.options.autoOpen&&this.openedChar(w,q)}else w.open===q.key&&this.options.autoOpen&&this.openedChar(w,q)}}catch(y){s=!0,t=y}finally{try{!r&&u.return&&u.return()}finally{if(s)throw t}}}},{key:'addEvent',value:function(q,r){return this.textarea.addEventListener(q,r,!1),this}},{key:'removeEvent',value:function(q,r){return this.textarea.removeEventListener(q,r,!1),this}},{key:'listen',value:function(){var q=this;this.listeners={keydown:[],keypress:[],keyup:[],input:[]},this.options.replaceTab&&this.listeners.keydown.push(this.tabKey.bind(this)),this.options.autoIndent&&this.listeners.keydown.push(this.enterKey.bind(this)),this.options.autoStrip&&this.listeners.keydown.push(this.deleteKey.bind(this)),this.options.continueList&&this.listeners.keydown.push(this.enterKeyList.bind(this)),this.options.moveLine&&this.listeners.keydown.push(this.moveLine.bind(this)),this.options.duplicateLine&&this.listeners.keydown.push(this.duplicateLine.bind(this)),this.listeners.keypress.push(this.filter.bind(this)),this.listeners.keydown.push(function(E){q.callHook('keydown',E)}),this.listeners.keyup.push(function(E){q.callHook('keyup',E)}),this.listeners.input.push(function(E){q.callHook('input',E)});var r=!0,s=!1,t=void 0;try{for(var v,u=Object.keys(this.listeners)[Symbol.iterator]();!(r=(v=u.next()).done);r=!0){var w=v.value,x=this.listeners[w],y=!0,z=!1,A=void 0;try{for(var C,B=x[Symbol.iterator]();!(y=(C=B.next()).done);y=!0){var D=C.value;this.addEvent(w,D)}}catch(E){z=!0,A=E}finally{try{!y&&B.return&&B.return()}finally{if(z)throw A}}}}catch(E){s=!0,t=E}finally{try{!r&&u.return&&u.return()}finally{if(s)throw t}}return this}},{key:'defineTabSize',value:function(q){return this.textarea.style[this.prefix('tab-size')]=q,this}},{key:'defineNewLine',value:function(){var q=document.createElement('textarea');return q.value='\n',this.newLine=2===q.value.length?'\r\n':'\n',this}},{key:'lineUp',value:function(){var q=0>=arguments.length||void 0===arguments[0]?this.getLines():arguments[0],r=1>=arguments.length||void 0===arguments[1]?0:arguments[1];if(0<r){var s=q[r],t=q[r-1];q[r]=t,q[r-1]=s}return q}},{key:'lineDown',value:function(){var q=0>=arguments.length||void 0===arguments[0]?this.getLines():arguments[0],r=1>=arguments.length||void 0===arguments[1]?0:arguments[1];if(r<q.length-1){var s=q[r],t=q[r+1];q[r]=t,q[r+1]=s}return q}},{key:'prefix',value:function(p){function q(r,s,t,u){return p.apply(this,arguments)}return q.toString=function(){return p.toString()},q}(function(p,q,r,s){for(s?s=q.toUpperCase():q=4;!s&&q--;s=(s=s.replace(/-(.)/g,prefix))in new Image().style&&s)s=[['Moz-','Webkit-','Ms-','O-'][q]]+p;return s||p})},{key:'init',value:function(){return this.isMac=/(Mac)/gi.test(navigator.platform),this.isWin=/(Win)/gi.test(navigator.platform),this.textarea&&(this.callHook('init:before'),this.defineNewLine(),this.options.softTabs?this.tab=' '.repeat(this.options.tabSize):(this.tab='\t',this.defineTabSize(this.options.tabSize)),this.listen(),this.callHook('init:after')),this}},{key:'destroy',value:function(){this.callHook('destroy:before');var q=!0,r=!1,s=void 0;try{for(var u,t=Object.keys(this.listeners)[Symbol.iterator]();!(q=(u=t.next()).done);q=!0){var v=u.value,w=this.listeners[v],x=!0,y=!1,z=void 0;try{for(var B,A=w[Symbol.iterator]();!(x=(B=A.next()).done);x=!0){var C=B.value;this.removeEvent(v,C)}}catch(D){y=!0,z=D}finally{try{!x&&A.return&&A.return()}finally{if(y)throw z}}}}catch(D){r=!0,s=D}finally{try{!q&&t.return&&t.return()}finally{if(r)throw s}}return this.callHook('destroy:before'),this}},{key:'value',get:function(){return this.textarea.value.replace(/\r/g,'')},set:function(q){this.textarea.value=q}}],[{key:'addHook',value:function(q,r){Array.isArray(q)||(q=[q]);var s=!0,t=!1,u=void 0;try{for(var w,v=q[Symbol.iterator]();!(s=(w=v.next()).done);s=!0){var x=w.value;m[x]||(m[x]=[]),m[x].push(r)}}catch(y){t=!0,u=y}finally{try{!s&&v.return&&v.return()}finally{if(t)throw u}}}},{key:'getHook',value:function(q){return m[q]}}]),o}();g.default=n,f.exports=g['default']});